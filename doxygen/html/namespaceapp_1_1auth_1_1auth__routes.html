<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Field Mapping Tasking Manager: app.auth.auth_routes Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Field Mapping Tasking Manager
   </div>
   <div id="projectbrief">Organize field mapping with ODK and OpenStreetMap</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceapp.html">app</a></li><li class="navelem"><a class="el" href="namespaceapp_1_1auth.html">auth</a></li><li class="navelem"><a class="el" href="namespaceapp_1_1auth_1_1auth__routes.html">auth_routes</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">app.auth.auth_routes Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:add0c4fabc2e8ee7bbd498992641e1012" id="r_add0c4fabc2e8ee7bbd498992641e1012"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceapp_1_1auth_1_1auth__routes.html#add0c4fabc2e8ee7bbd498992641e1012">login_url</a> (osm_auth=Depends(init_osm_auth))</td></tr>
<tr class="separator:add0c4fabc2e8ee7bbd498992641e1012"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a551bdd65c1522635df66011016be2ae3" id="r_a551bdd65c1522635df66011016be2ae3"><td class="memItemLeft" align="right" valign="top">JSONResponse&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceapp_1_1auth_1_1auth__routes.html#a551bdd65c1522635df66011016be2ae3">callback</a> (Request request, Annotated[<a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a>, Depends(init_osm_auth)] osm_auth)</td></tr>
<tr class="separator:a551bdd65c1522635df66011016be2ae3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaaba7356871671cd85a2b49237204912" id="r_aaaba7356871671cd85a2b49237204912"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceapp_1_1auth_1_1auth__routes.html#aaaba7356871671cd85a2b49237204912">logout</a> ()</td></tr>
<tr class="separator:aaaba7356871671cd85a2b49237204912"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab830aad90f3f58560846a7412b1a48c0" id="r_ab830aad90f3f58560846a7412b1a48c0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceapp_1_1auth_1_1auth__routes.html#ab830aad90f3f58560846a7412b1a48c0">get_or_create_user</a> (Connection db, <a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a> user_data)</td></tr>
<tr class="separator:ab830aad90f3f58560846a7412b1a48c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0d9ded54132e1e3dd452ec296191dfe" id="r_ac0d9ded54132e1e3dd452ec296191dfe"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceapp_1_1auth_1_1auth__routes.html#ac0d9ded54132e1e3dd452ec296191dfe">my_data</a> (Annotated[Connection, Depends(db_conn)] db, Annotated[<a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a>, Depends(login_required)] current_user)</td></tr>
<tr class="separator:ac0d9ded54132e1e3dd452ec296191dfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a753aca5b530661d054a452814dad78e1" id="r_a753aca5b530661d054a452814dad78e1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceapp_1_1auth_1_1auth__routes.html#a753aca5b530661d054a452814dad78e1">refresh_management_cookies</a> (Request request, Annotated[<a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a>, Depends(login_required)] current_user)</td></tr>
<tr class="separator:a753aca5b530661d054a452814dad78e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd813784ee286ab9351d23fb2979b80a" id="r_abd813784ee286ab9351d23fb2979b80a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceapp_1_1auth_1_1auth__routes.html#abd813784ee286ab9351d23fb2979b80a">refresh_mapper_token</a> (Request request, Annotated[<a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a>, Depends(mapper_login_required)] current_user)</td></tr>
<tr class="separator:abd813784ee286ab9351d23fb2979b80a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a80a5ec39fad19939dfedec98a6b15a82" id="r_a80a5ec39fad19939dfedec98a6b15a82"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceapp_1_1auth_1_1auth__routes.html#a80a5ec39fad19939dfedec98a6b15a82">router</a></td></tr>
<tr class="separator:a80a5ec39fad19939dfedec98a6b15a82"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Auth routes, to login, logout, and get user details.</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a551bdd65c1522635df66011016be2ae3" name="a551bdd65c1522635df66011016be2ae3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a551bdd65c1522635df66011016be2ae3">&#9670;&#160;</a></span>callback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> JSONResponse app.auth.auth_routes.callback </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Annotated[<a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a>, Depends(init_osm_auth)]
&#160;</td>
          <td class="paramname"><em>osm_auth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Performs oauth token exchange with OpenStreetMap.

Provides an access token that can be used for authenticating other endpoints.
Also returns a cookie containing the access token for persistence in frontend apps.
</pre> 
<p class="definition">Definition at line <a class="el" href="auth__routes_8py_source.html#l00072">72</a> of file <a class="el" href="auth__routes_8py_source.html">auth_routes.py</a>.</p>

</div>
</div>
<a id="ab830aad90f3f58560846a7412b1a48c0" name="ab830aad90f3f58560846a7412b1a48c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab830aad90f3f58560846a7412b1a48c0">&#9670;&#160;</a></span>get_or_create_user()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.auth.auth_routes.get_or_create_user </td>
          <td>(</td>
          <td class="paramtype">Connection&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a>&#160;</td>
          <td class="paramname"><em>user_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Get user from User table if exists, else create.</pre> 
<p class="definition">Definition at line <a class="el" href="auth__routes_8py_source.html#l00121">121</a> of file <a class="el" href="auth__routes_8py_source.html">auth_routes.py</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceapp_1_1auth_1_1auth__routes_ab830aad90f3f58560846a7412b1a48c0_icgraph.png" border="0" usemap="#anamespaceapp_1_1auth_1_1auth__routes_ab830aad90f3f58560846a7412b1a48c0_icgraph" alt=""/></div>
<map name="anamespaceapp_1_1auth_1_1auth__routes_ab830aad90f3f58560846a7412b1a48c0_icgraph" id="anamespaceapp_1_1auth_1_1auth__routes_ab830aad90f3f58560846a7412b1a48c0_icgraph">
<area shape="rect" title=" " alt="" coords="275,5,460,45"/>
<area shape="rect" href="namespaceapp_1_1auth_1_1auth__routes.html#ac0d9ded54132e1e3dd452ec296191dfe" title=" " alt="" coords="5,13,227,38"/>
<area shape="poly" title=" " alt="" coords="261,28,227,28,227,23,261,23"/>
</map>
</div>

</div>
</div>
<a id="add0c4fabc2e8ee7bbd498992641e1012" name="add0c4fabc2e8ee7bbd498992641e1012"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add0c4fabc2e8ee7bbd498992641e1012">&#9670;&#160;</a></span>login_url()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.auth.auth_routes.login_url </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>osm_auth</em> = <code>Depends(init_osm_auth)</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Get Login URL for OSM Oauth Application.

The application must be registered on openstreetmap.org.
Open the download url returned to get access_token.

Args:
    request: The GET request.
    osm_auth: The Auth object from osm-login-python.

Returns:
    login_url (string): URL to authorize user in OSM.
        Includes URL params: client_id, redirect_uri, permission scope.
</pre> 
<p class="definition">Definition at line <a class="el" href="auth__routes_8py_source.html#l00052">52</a> of file <a class="el" href="auth__routes_8py_source.html">auth_routes.py</a>.</p>

</div>
</div>
<a id="aaaba7356871671cd85a2b49237204912" name="aaaba7356871671cd85a2b49237204912"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaaba7356871671cd85a2b49237204912">&#9670;&#160;</a></span>logout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.auth.auth_routes.logout </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Reset httpOnly cookie to sign out user.</pre> 
<p class="definition">Definition at line <a class="el" href="auth__routes_8py_source.html#l00089">89</a> of file <a class="el" href="auth__routes_8py_source.html">auth_routes.py</a>.</p>

</div>
</div>
<a id="ac0d9ded54132e1e3dd452ec296191dfe" name="ac0d9ded54132e1e3dd452ec296191dfe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0d9ded54132e1e3dd452ec296191dfe">&#9670;&#160;</a></span>my_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.auth.auth_routes.my_data </td>
          <td>(</td>
          <td class="paramtype">Annotated[Connection, Depends(db_conn)]&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Annotated[<a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a>, Depends(login_required)]&#160;</td>
          <td class="paramname"><em>current_user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Read access token and get user details from OSM.

Args:
    db (Connection): The db connection.
    current_user (AuthUser): User data provided by osm-login-python Auth.

Returns:
    FMTMUser: The dict of user data.
</pre> 
<p class="definition">Definition at line <a class="el" href="auth__routes_8py_source.html#l00198">198</a> of file <a class="el" href="auth__routes_8py_source.html">auth_routes.py</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceapp_1_1auth_1_1auth__routes_ac0d9ded54132e1e3dd452ec296191dfe_cgraph.png" border="0" usemap="#anamespaceapp_1_1auth_1_1auth__routes_ac0d9ded54132e1e3dd452ec296191dfe_cgraph" alt=""/></div>
<map name="anamespaceapp_1_1auth_1_1auth__routes_ac0d9ded54132e1e3dd452ec296191dfe_cgraph" id="anamespaceapp_1_1auth_1_1auth__routes_ac0d9ded54132e1e3dd452ec296191dfe_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,227,38"/>
<area shape="rect" href="namespaceapp_1_1auth_1_1auth__routes.html#ab830aad90f3f58560846a7412b1a48c0" title=" " alt="" coords="275,5,460,45"/>
<area shape="poly" title=" " alt="" coords="227,23,261,23,261,28,227,28"/>
</map>
</div>

</div>
</div>
<a id="a753aca5b530661d054a452814dad78e1" name="a753aca5b530661d054a452814dad78e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a753aca5b530661d054a452814dad78e1">&#9670;&#160;</a></span>refresh_management_cookies()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.auth.auth_routes.refresh_management_cookies </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Annotated[<a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a>, Depends(login_required)]&#160;</td>
          <td class="paramname"><em>current_user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Uses the refresh token to generate a new access token.

This endpoint is specific to the management desktop frontend.
Any temp auth cookies will be ignored and removed.
OSM login is required.

NOTE this endpoint has no db calls and returns in ~2ms.
</pre> 
<p class="definition">Definition at line <a class="el" href="auth__routes_8py_source.html#l00215">215</a> of file <a class="el" href="auth__routes_8py_source.html">auth_routes.py</a>.</p>

</div>
</div>
<a id="abd813784ee286ab9351d23fb2979b80a" name="abd813784ee286ab9351d23fb2979b80a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd813784ee286ab9351d23fb2979b80a">&#9670;&#160;</a></span>refresh_mapper_token()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.auth.auth_routes.refresh_mapper_token </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Annotated[<a class="el" href="classapp_1_1auth_1_1auth__schemas_1_1AuthUser.html">AuthUser</a>, Depends(mapper_login_required)]&#160;</td>
          <td class="paramname"><em>current_user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Uses the refresh token to generate a new access token.

This endpoint is specific to the mapper mobile frontend.
By default the user will be logged in with a temporary auth cookie.
OSM auth is optional, if the user wishes to be attributed for contributions.

NOTE this endpoint has no db calls and returns in ~2ms.
</pre> 
<p class="definition">Definition at line <a class="el" href="auth__routes_8py_source.html#l00236">236</a> of file <a class="el" href="auth__routes_8py_source.html">auth_routes.py</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a80a5ec39fad19939dfedec98a6b15a82" name="a80a5ec39fad19939dfedec98a6b15a82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80a5ec39fad19939dfedec98a6b15a82">&#9670;&#160;</a></span>router</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.auth.auth_routes.router</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  APIRouter(</div>
<div class="line"><span class="lineno">    2</span>    prefix=<span class="stringliteral">&quot;/auth&quot;</span>,</div>
<div class="line"><span class="lineno">    3</span>    tags=[<span class="stringliteral">&quot;auth&quot;</span>],</div>
<div class="line"><span class="lineno">    4</span>    responses={404: {<span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;Not found&quot;</span>}},</div>
<div class="line"><span class="lineno">    5</span>)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="auth__routes_8py_source.html#l00044">44</a> of file <a class="el" href="auth__routes_8py_source.html">auth_routes.py</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
